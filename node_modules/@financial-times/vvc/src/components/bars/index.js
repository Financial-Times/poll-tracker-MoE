/**
 * @file
 * Bars geometry
 */

import React from 'react';
import { Group } from '@visx/group';
import { Bar } from '@visx/shape';
import { barsComponentPropTypes } from '../prop-types';
import { barsComponentDefaultProps } from '../default-props';

const Bars = ({
  data,
  fill,
  height,
  width,
  xScale,
  xVariable,
  yScale,
  yVariable,
  colorScale,
  colorVariable,
  barHeightVariable,
  fixedBarHeight,
  automaticallySetRange,
}) => {
  if (automaticallySetRange) {
    xScale.range([0, width]);
    if (!fixedBarHeight) {
      yScale.range([0, height]);
    }
  }

  return (
    <Group className="vv-bars">
      {data.map((d) => {
        // These values are specific to each bar
        const barHeight = barHeightVariable ? yScale(d[barHeightVariable]) : yScale.bandwidth();
        const barWidth = xScale(d[xVariable]);
        const yPosition = yScale(d[yVariable]);
        const barFill = colorScale ? colorScale(d[colorVariable]) : fill;

        return (
          <Bar
            key={`bar-${d[yVariable]}`}
            x={d[xVariable] > 0 ? xScale(0) : barWidth}
            y={yPosition}
            width={Math.abs(xScale(0) - barWidth)}
            height={barHeight}
            fill={barFill}
          />
        );
      })}
    </Group>
  );
};

Bars.propTypes = barsComponentPropTypes;
Bars.defaultProps = barsComponentDefaultProps;

export default Bars;
