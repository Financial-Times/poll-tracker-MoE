import { Meta, Story, Preview } from '@storybook/addon-docs/blocks';
import { useState } from 'react';
import { scaleLinear, scaleTime } from '@visx/scale';
import { extent } from 'd3-array';
import ChartFrame from '../chart-frame';
import dateContinuousLogSampleData from '../../sample-data/date-continuous-log.js';
import { extentMulti } from '../../util/parseData';
import { Dots } from '../dots';
import Delaunay from './';

<Meta title="Components/Delaunay" component={Delaunay} />

# Delaunay

Adds a delaunay triangulation to a chart which can be used to enable tooltips.

Sets and updates `hoveredSeries`, `hoveredData` and `mousePoint` state in the `PlotContext`.

- When using highlighted lines with all lines hoverable, `hoveredSeries` (String) gets set when a ghost line is hovered over
- `hoveredData` (Object: { y: Number, x: Number, seriesName: String }) is set when a point in highlighted line is hovered over
- `mousePoint` (Object: { mx: Number, my: Number }) is set on mouse move when the `debug` prop is set to true. It is used to help draw the hover radius in debug mode

export const sineDataOverTime = Array(10)
  .fill()
  .map((d, i) => ({
    x: i,
    y: Math.sin(i),
    color: 'blue',
    label: `item: ${i}`,
    labelData: `item: ${i}`,
    id: i,
  }));

### Basic use (w/ dots)

<Preview>
  <Story name="Basic use (w/ dots)">
    <ChartFrame>
      <Dots
        data={sineDataOverTime}
        xScale={scaleTime({ domain: extent(sineDataOverTime, (d) => d.x) })}
        yScale={scaleLinear({
          domain: extent(sineDataOverTime, (d) => d.y),
        })}
        xVariable="x"
        yVariable="y"
        colorVariable="color"
      />
      <Delaunay
        data={sineDataOverTime}
        xScale={scaleTime({ domain: extent(sineDataOverTime, (d) => d.x) })}
        yScale={scaleLinear({
          domain: extent(sineDataOverTime, (d) => d.y),
        })}
        colorScale={() => 'blue'}
        xVariable="x"
        yVariable="y"
        debug
        showLine={true}
        tooltipPositionOverride={({ data, xScale, yScale }) => ({
          x: xScale(data.x),
          y: yScale(data.y) - 10,
        })}
      />
    </ChartFrame>
  </Story>
</Preview>

### Basic use (w/ hover radius)

<Preview>
  <Story name="Basic use (w / hover radius)">
    <ChartFrame>
      <Dots
        data={sineDataOverTime}
        xScale={scaleTime({ domain: extent(sineDataOverTime, (d) => d.x) })}
        yScale={scaleLinear({
          domain: extent(sineDataOverTime, (d) => d.y),
        })}
        xVariable="x"
        yVariable="y"
        colorVariable="color"
      />
      <Delaunay
        data={sineDataOverTime}
        xScale={scaleTime({ domain: extent(sineDataOverTime, (d) => d.x) })}
        yScale={scaleLinear({
          domain: extent(sineDataOverTime, (d) => d.y),
        })}
        colorScale={() => 'blue'}
        xVariable="x"
        yVariable="y"
        debug
        showLine={true}
        tooltipPositionOverride={({ data, xScale, yScale }) => ({
          x: xScale(data.x),
          y: yScale(data.y) - 10,
        })}
        hoverRadius={50}
      />
    </ChartFrame>
  </Story>
</Preview>
