import { Meta, Story, Preview } from '@storybook/addon-docs/blocks';
import { css } from '@emotion/core';
import { letterFrequency } from '@visx/mock-data';
import { scaleOrdinal, scaleLinear, scaleThreshold, scaleSqrt } from '@visx/scale';
import ChartFrame from '../chart-frame';
import Debug from '../../util/debug';
import Axis from './';
import Legend from './';

export const partyScale = scaleOrdinal({
  domain: ['CDU/CSU', 'SPD', 'FDP', 'Left', 'AfD', 'Green', 'Other'],
  range: ['#33302E', '#F34D5B', '#fcc83c', '#B3325D', '#1E8FCC', '#AECC70', '#CEC6B9'],
});

export const redThreshold = scaleThreshold({
  domain: [0, 4.3, 5.4, 7.0, 10.1, 14.8, 20.1],
  range: ['#f3dec8', '#f1b499', '#e88a6e', '#d7604c', '#bf3536', '#990f3d'],
});

export const redThresholdSmall = scaleThreshold({
  domain: [0, 5, 10, 20.0],
  range: ['#f3dec8', '#f1b499', '#e88a6e', '#d7604c', '#bf3536'],
});

export const zeroMagnitude = scaleSqrt({
  domain: [0, 20],
  range: [0, 50],
});

export const badMagnitude = scaleSqrt({
  domain: [5, 20],
  range: [0, 50],
});

export const shipSize = scaleSqrt({
  domain: [5000, 20000, 50000, 100000],
  range: [0, 50],
});

<Meta title="Components/Legend" component={Legend} />

# Legend

Pre styled draggable component that will return various chart legend types, composed entirely of svg elements. The legend needs to be called into a pre existing SVG (chart frame) as it does not create its own holding SVG. The top level is a 'Group' elelment with the id 'legendCategorical, 'legendThreshold' etc. The React in this component does not return any HTML div elements.

<Preview>
  <Story name="Legend">
    <svg width={1000} height={180}>
      <Legend  draggable ={false}/>
      <Legend geometry={'circle'} posX={170} draggable ={false} />
      <Legend geometry={'line'} posX={340}  draggable ={false}/>
      <Legend
        legendType={'threshold'}
        height={140}
        scale={redThresholdSmall}
        orientation={'vertical'}
        median={6.2}
        posX={500}
        posY={16}
        draggable ={false}
      />
      <Legend legendType={"magnitude"} posX={640} draggable ={false}/>
    </svg>
  </Story>
</Preview>

## Getting started

The legend component has a default scale and just calling the component without any props will return a default:

### Default draggable legend

<Preview>
  <Story name="Default legend">
    <svg height="180">
      <Legend />
    </svg>
  </Story>
</Preview>

You'll obviously need to define your own data, which you do through the **scale** prop (categorical legends use an ordinal scale):

```
const partyScale = scaleOrdinal({
    domain: ['CDU/CSU', 'SPD', 'FDP', 'Left', 'AfD', 'Green', 'Other'],
    range: ['#33302E', '#F34D5B', '#fcc83c', '#B3325D', '#1E8FCC', '#AECC70', '#CEC6B9']
  })
```

Unless specified the **seriesName** prop is calculated from the **scale.domain** and so is optional. Its main purpose is to render a subset legend, this allows you to load pre-defined scales from libraries but only render specific items. For example the German electoral parties where you chart only focusses on three parties and would not need the full domain rendering.

<Preview>
  <Story name="Custom scale">
    <svg height="150">
      <Legend scale={partyScale}  draggable ={false}/>
      <Legend scale={partyScale} posX={180} seriesNames={['SPD', 'FDP', 'Left']}  draggable={false} />
    </svg>
  </Story>
</Preview>

## Prerequisites

This bit to come when built

## Dependencies

This bit to come when built

## <a id="types">Legend types</a>

There are three legend types available

- [Categorical legend](#Categorical)
- [Threshold legend](#Threshold)
- [Magnitude legend](#Magnitude)

## <a id="props">Props</a>

- **legendType [string]** Change the type of legend returned 'categorical', 'threshold' and 'magnitude'
- **scale [function]** Sets user defined scale for magnitude legend
- **seriesNames [array]** Allows a subset legend to be rendered
- **geometry [string]** Shape of the legend symbols 'rect', 'circle' or 'line'
- **orientation [string]** horizontal' or 'vertical'
- ** invert [boolean]** Reverses the legend order, usefule on stacked bar charts. Categorical and threshold legends only
- **legendWidth [number]** Threshold legends only
- **legendHeight [number]** Threshold legends only
- **posX [number]** Postions the legend horizontally
- **PosY [number]** Postions the legend vertically
- **median [number]** Threshold legends only
- **draggable [boolean]** Makes the legebd draggable or not. true by default

## <a id="Categorical" >Categorical legend</a>

Uses rectangles, circles or lines coloured by group to denote distinct ordinal catagories of data. This is the default legend if the component is called without any props. Its structure is defined by an ordinal scale, the domain defines the categories and the range defines the colours. It will accept the following props:

- **scale [function]** User defined scale
- **seriesNames [array]** Allows a subset legend to be rendered
- **geometry [string]** Shape of the legend symbols 'rect', 'circle' or 'line'
- **orientation [string]** 'horizontal' or 'vertical'
- **invert [boolean]** Reverses the legend order, usefule on stacked bar charts
- **posX [number]** Postions the legend horizontally
- **posY [number]** Postions the legend vertically
- **draggable [boolean]** Makes the legebd draggable or not. true by default

[back to legend types](#types)

### <a id="catExamples">Examples of a categorical legend</a>

- [Categorical-default rect legend and defined scale](#catExample1)
- [Categorical-rect-horizontal orientation](#catExample2)
- [Categorical-circle](#catExample3)
- [Categorical-circle-horizontal orientation](#catExample4)
- [Categorical-line](#catExample5)
- [Categorical-line-hor](#catExample6)

[back to legend types](#types)

### <a id="catExample1">Default legend and custom scale examples</a>

Using the folwing ordinal scale:

```
const partyScale = scaleOrdinal({
    domain: ['CDU/CSU', 'SPD', 'FDP', 'Left', 'AfD', 'Green', 'Other'],
    range: ['#33302E', '#F34D5B', '#fcc83c', '#B3325D', '#1E8FCC', '#AECC70', '#CEC6B9']
  })
```

<Preview>
  <Story name="Categorical-rect">
    <svg height="180" width="600">
      <Legend  draggable={false}/>
      <Legend  draggable={false} scale={partyScale} posX="200" />
      <Legend  draggable={false} scale={partyScale} seriesNames={['CDU/CSU', 'SPD', 'FDP', 'Left']} posX="350" />
      <Legend
       draggable={false}
        scale={partyScale}
        invert={true}
        seriesNames={['CDU/CSU', 'SPD', 'FDP', 'Left']}
        posX="500"
      />
    </svg>
  </Story>
</Preview>

[back to categorical examples](#catExamples)

### <a id="catExample2">Catagorica legend with horizontal orientation</a>

<Preview>
  <Story name="Categorical-rect-hori">
    <svg width="1000" height="120">
      <Legend orientation={'horizontal'} draggable={false} />
      <Legend scale={partyScale} orientation={'horizontal'} posY={35} draggable={false} />
      <Legend
       draggable={false}
        scale={partyScale}
        seriesNames={['CDU/CSU', 'SPD', 'FDP', 'Left']}
        orientation={'horizontal'}
        posY={60}
      />
      <Legend
       draggable={false}
        scale={partyScale}
        seriesNames={['CDU/CSU', 'SPD', 'FDP', 'Left']}
        invert={true}
        orientation={'horizontal'}
        posY={85}
      />
    </svg>
  </Story>
</Preview>

[back to categorical examples](#catExamples)

### <a id="catExample3">Categorical legend with geometry set as circle</a>

<Preview>
  <Story name="Categorical-circle">
    <svg height="180" width="800">
      <Legend geometry={'circle'}  draggable={false}/>
      <Legend geometry={'circle'}  draggable={false} scale={partyScale} posX={200} />
      <Legend
       draggable={false}
        geometry={'circle'}
        scale={partyScale}
        seriesNames={['CDU/CSU', 'SPD', 'FDP', 'Left']}
        posX={350}
      />
      <Legend
       draggable={false}
        geometry={'circle'}
        invert={true}
        scale={partyScale}
        seriesNames={['CDU/CSU', 'SPD', 'FDP', 'Left']}
        posX={500}
      />
    </svg>
  </Story>
</Preview>

[back to categorical examples](#catExamples)

### <a id="catExample4">Categorical legend with circle geometry and a horizontal orientation</a>

<Preview>
  <Story name="Categorical-circle-hori">
    <svg width="1000" height="120">
      <Legend  draggable={false} geometry={'circle'} orientation={'horizontal'} />
      <Legend  draggable={false} geometry={'circle'} scale={partyScale} orientation={'horizontal'} posY={35} />
      <Legend
       draggable={false}
        geometry={'circle'}
        scale={partyScale}
        seriesNames={['CDU/CSU', 'SPD', 'FDP', 'Left']}
        orientation={'horizontal'}
        posY={60}
      />
      <Legend
       draggable={false}
        geometry={'circle'}
        scale={partyScale}
        seriesNames={['CDU/CSU', 'SPD', 'FDP', 'Left']}
        invert={true}
        orientation={'horizontal'}
        posY={85}
      />
    </svg>
  </Story>
</Preview>

[back to categorical examples](#catExamples)

### <a id="catExample6">Categorical legend with geometry set as line and horizontal orientation</a>

<Preview>
  <Story height={120} name="Categorical-line-hori">
    <svg width="900" height="120">
      <Legend  draggable={false} geometry={'line'} orientation={'horizontal'} />
      <Legend  draggable={false} geometry={'line'} scale={partyScale} orientation={'horizontal'} posY={35} />
      <Legend
       draggable={false}
        geometry={'line'}
        scale={partyScale}
        seriesNames={['CDU/CSU', 'SPD', 'FDP', 'Left']}
        orientation={'horizontal'}
        posY={60}
      />
      <Legend
       draggable={false}
        geometry={'line'}
        scale={partyScale}
        seriesNames={['CDU/CSU', 'SPD', 'FDP', 'Left']}
        invert={true}
        orientation={'horizontal'}
        posY={85}
      />
    </svg>
  </Story>
</Preview>

[back to categorical examples](#catExamples)

## <a id="Threshold">Theshold legend</a>

Defines a series of ranges or bins for grouping together linear numeric data using coloured rectangles to denote each range. Often used in choropleths. Takes a scaleThreshold() prop to define its structure. Unlike many threshold scales the minimum and maximum are **not** implied values and **must** be set. Consiquently the domain of the scale prop must always have **one more value than the range** e.g.

```
const defaultscale = scaleThreshold({
  domain: [0, 3.3, 4.3, 5.4, 7, 10.1, 14.8, 20.1],
  range: ['#d6d3ea', '#adb8e6', '#849cdb', '#5e82c8', '#3968ad', '#1b4f8d', '#0a3866'],
});
```

The default orientation is horizontal
The threshold legend accepts the following props:

- **scale [function]** User defined scale, do not use 'scale' when defining this legend'
- **orientation [string]** 'horizontal' or 'vertical'
- **invert [boolean]** Reverses the legend order, usefule on choropleths plotting deprivation
- **legendWidth [number]** (applies to the horizontal orientation only)
- **legendHeight [number]** (applies to the vertical orientation only)
- **posX [number]** Postions the legend horizontally
- **posY [number]** Postions the legend vertically
- **median [number]**
- **draggable [boolean]** Makes the legebd draggable or not. true by default

[back to legend types](#types)

## <a id="thrsExamples">Examples of a threshold legends</a>

- [Threshold-horizontal](#thrExample1)
- [Threshold-vertical](#thrExample2)

### <a id="thrExample1">Threshold with horizontal orientation</a>

The default width setting is 500px

<Preview>
  <Story name="Threshold-horizontal">
    <svg width="1000" height="210">
      <Legend  draggable={false} legendType={'threshold'} orientation={'horizontal'} />
      <Legend
       draggable={false}
        legendType={'threshold'}
        orientation={'horizontal'}
        width={700}
        scale={redThreshold}
        posY={80}
        median={10.2}
      />
      <Legend  draggable={false} legendType={'threshold'} orientation={'horizontal'} invert={true} posY={150} />
    </svg>
  </Story>
</Preview>

### <a id="thrExample2">Threshold with vertical orientation</a>

The default height for a vertical threshold legend is 250px

<Preview>
  <Story name="Threshold-vertical">
    <svg width={600} height={270}>
      <Legend  draggable={false} legendType={'threshold'} orientation={'vertical'} />
      <Legend  draggable={false} legendType={'threshold'} orientation={'vertical'} invert={true} posX={200} />
      <Legend
       draggable={false}
        legendType={'threshold'}
        orientation={'vertical'}
        scale={redThreshold}
        posX={400}
        median={10.2}
      />
    </svg>
  </Story>
</Preview>

[back to thresholf examples](#thrsExamples)

## <a id="Magnitude" >Magnitude legend</a>

Uses circles sized by area to denote minimunm and maximum values in a range of numeric data and other significant values in between. Most commonly used on bubble plots and uses the scaleSqrt to define its structure.

### <a>important notes</a>

Some **care should be taken** when specifing a magnitude legend as all values must be plottod relative to zero (this is the same for bubble plot charts). This is why the scale domain and range arrays have their minimum values hard coded as zero, no matter what scale values are passed. Consiquently it is important to pass a **seriesNames** when calling a magnitude legend. A legend passed the following (correct) scale:

```
const zeroMagnitude = scaleSqrt({
  domain: [0, 20],
  range: [0, 50],
});
```
will render a legend with just one circle, as circles with a diameter of zero cannot be rendered. Passing the **seriesNames** should return the correct result

<Preview>
  <Story name="zero min magnitude">
    <svg width ='800'>
      <Legend draggable={false} legendType={"magnitude"} scale ={zeroMagnitude} label={'no seriesNames'}/>
      <Legend draggable={false} legendType={"magnitude"} scale ={zeroMagnitude} posX={210} seriesNames={[5,20]} label={'With seriesNames'}/>
    </svg>
  </Story>
</Preview>

It **should also be noted** that passing a scale with minimum domain and rnage values other than zero (below) would be incorect. The domain and range minimum values must **always** be zero. The legend component will resolve this but, if you are passing a scale like this from a bubble chart then circles on the chart may be rendered incorrectly.

```
const badMagnitude = scaleSqrt({
  domain: [5, 20],
  range: [0, 50],
});
```
The legend component will overide the value of minimum domain value of five with zero, but automatically creates a seriesNames of [5,20] to render the circles
<Preview>
  <Story name="rersolved agnitude">
    <svg width ='800'>
      <Legend  draggable={false} legendType={"magnitude"} scale={badMagnitude}/>
    </svg>
  </Story>
</Preview>


As with the categorical legend using **seriesNames** will allow you to render sub legend (shown in the second example below). Any value of zero in the seriesNames array will be automatically removed as yo can not render a circle with a radius value of zero.

The scale will accept the following props:

- **scale [function]** User defined scale, do not use 'scale' when defining this legend'
- **seriesNames [array]** Allows a subset legend to be rendered
- **posX [number]** Postions the legend horizontally
- **posY [number]** Postions the legend vertically
- **draggable [boolean]** Makes the legebd draggable or not. true by default

The default scale for the magnitude legend is:

```
const scale = scaleSqrt({
  domain: [0,5,20],
  range: [0, 50],
});
```
User defined scale for third example:

```
const shipSize = scaleSqrt({
  domain: [5000, 20000, 50000, 100000, 20000],
  range: [0, 50],
});
```

### <a>Examples of a magnitude legend</a>

<Preview>
  <Story name="Magnitude">
    <svg width ='800'>
      <Legend draggable={false} legendType={"magnitude"}/>
      <Legend draggable={false} legendType={"magnitude"} posX={210} seriesNames={[5, 10,15]} label={'Age'}/>
      <Legend draggable={false} legendType={"magnitude"} scale={shipSize} posX={410} label={'Tonnes'}/>
    </svg>
  </Story>
</Preview>

[back to legend types](#types)
