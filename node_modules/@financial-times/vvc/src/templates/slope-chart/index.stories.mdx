import { Meta, Story, Preview } from '@storybook/addon-docs/blocks';
import ChartFrame from '../../components/chart-frame';
import SlopeChart from './';
import slopeData from '../../sample-data/ge2019-slopes-with-byelections.json';
import finalSlopeData from '../../sample-data/ge2019-slopes-end.json';
export const slopeDataByElections = slopeData.filter(([, dates]) => Object.keys(dates).length > 2);

export const exampleData = {
  '2015-05-07': { green: 60, labour: 30, conservative: 10 },
  '2017-06-08': { green: 65, labour: 32.5, conservative: 5 },
};

export const exampleDataComplete = {
  '2015-05-07': { green: 60, labour: 30, conservative: 10 },
  '2017-06-08': { green: 65, labour: 32.5, conservative: 5 },
  '2019-12-12': { green: 80, labour: 15, conservative: 5 },
};

export const exampleDataByElection = {
  '2015-05-07': { green: 60, labour: 30, conservative: 10 },
  '2016-01-01': { green: 70, labour: 25, conservative: 5 },
  '2017-06-08': { green: 65, labour: 32.5, conservative: 5 },
  '2018-01-01': { green: 70, labour: 25, conservative: 5 },
};

export const exampleDataCloseRace = {
  '2015-05-07': { green: 60, labour: 30, conservative: 10 },
  '2017-06-08': { green: 45, labour: 40, conservative: 15 },
};

export const exampleDataCloseRaceByElection = {
  '2015-05-07': { green: 60, labour: 30, conservative: 10 },
  '2016-01-01': { green: 25, labour: 25, conservative: 50 },
  '2017-06-08': { green: 65, labour: 32.5, conservative: 5 },
  '2018-01-01': { green: 33, labour: 33, conservative: 33 },
};

export const exampleDataWithNewEntrants = {
  '2015-05-07': { green: 60, labour: 30, conservative: 10 },
  '2017-06-08': { green: 65, labour: 32.5, ukip: 3, conservative: 5 },
};
export const exampleDataWithNewEntrantsAndByElection = {
  '2015-05-07': { green: 60, labour: 30, conservative: 10 },
  '2017-06-08': { green: 65, labour: 32.5, ukip: 3, conservative: 5 },
  '2018-01-01': { green: 70, labour: 25, brexit: 3, conservative: 5 },
};

export const exampleDataWithSpeaker = {
  '2015-05-07': { green: 60, labour: 30, conservative: 10 },
  '2017-06-08': { green: 65, labour: 32.5, ukip: 3, conservative: 5 },
  '2019-12-12': { 'The Speaker': 84.4, labour: 25, brexit: 3, conservative: 5 },
};

export const interestingIndependentConstituencyCodes = [
  'E14000550',
  'E14000951',
  'E14000559',
  'E14000607',
  'E14000760',
  'E14000865',
  'E14000678',
];

<Meta title="Templates/Elections/Slope chart" component={SlopeChart} />

# Slope chart

Type: @TODO

@TODO description

**When to use**

@TODO

**Examples from the FT:**

@TODO

**Questions?**

- Shepherd: TKTK
- Developer: TKTK

---

## Demos

---

### Basic slope chart

<Preview>
  <Story name="Slope chart Basic">
    <SlopeChart data={exampleData} />
  </Story>
</Preview>

### Basic slope chart (GE2019 complete)

<Preview>
  <Story name="Slope chart Basic complete">
    <SlopeChart data={exampleDataComplete} />
  </Story>
</Preview>

### Basic slope chart with by-election

<Preview>
  <Story name="Slope chart Basic with By-Election">
    <SlopeChart data={exampleDataByElection} />
  </Story>
</Preview>

### Slope chart with a close race

<Preview>
  <Story name="Close race label positioning demo">
    <SlopeChart data={exampleDataCloseRace} />
  </Story>
</Preview>

### Slope chart with a close race as by-election

<Preview>
  <Story name="Close race label positioning demo as by-election">
    <SlopeChart data={exampleDataCloseRaceByElection} />
  </Story>
</Preview>

### Basic slope chart for Autograph

<Preview>
  <Story name="Slope chart for Autograph">
    <SlopeChart
      width={600}
      type="frameless"
      stabRule={false}
      title={false}
      subtitle={false}
      data={exampleData}
    />
  </Story>
</Preview>

### Slope chart with new entrants

<Preview>
  <Story name="Slope chart with new entrants">
    <SlopeChart data={exampleDataWithNewEntrants} />
  </Story>
</Preview>

### Slope chart with new entrants by-election

<Preview>
  <Story name="Slope chart with new entrants via by-election">
    <SlopeChart data={exampleDataWithNewEntrantsAndByElection} />
  </Story>
</Preview>

### Slope chart with speaker

<Preview>
  <Story name="Slope chart with speaker">
    <div>
      <SlopeChart data={exampleDataWithSpeaker} />
    </div>
  </Story>
</Preview>

### Slopes from actual data

<Preview>
  <Story name="Slope chart multiples from real data">
    <div>
      {slopeData
        .filter(([, d]) => Object.keys(d).length === 2)
        .slice(0, 5)
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

### Test cases -- Devon East:

<Preview>
  <Story name="Test case -- Devon East">
    <div>
      {slopeData
        .filter(([id]) => id === 'E14000678')
        .slice(0, 5)
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

### Test case -- Copeland:

<Preview>
  <Story name="Test case -- Copeland">
    <div>
      {slopeData
        .filter(([id]) => id === 'E14000647')
        .slice(0, 5)
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

### Test case -- Stoke-on-Trent Central:

<Preview>
  <Story name="Test case -- Stoke-on-Trent Central">
    <div>
      {slopeData
        .filter(([id]) => id === 'E14000972')
        .slice(0, 5)
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

### Test case -- Sleaford and North Hykeham:

<Preview>
  <Story name="Test case -- Sleaford and North Hykeham">
    <div>
      {slopeData
        .filter(([id]) => id === 'E14000929')
        .slice(0, 5)
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

### Test case -- Richmond Park:

<Preview>
  <Story name="Test case -- Richmond Park">
    <div>
      {slopeData
        .filter(([id]) => id === 'E14000896')
        .slice(0, 5)
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

### Test case -- Witney:

<Preview>
  <Story name="Test case Witney">
    <div>
      {slopeData
        .filter(([id]) => id === 'E14001046')
        .slice(0, 5)
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

### Test case -- Batley and Spen:

<Preview>
  <Story name="Test case -- Batley and Spen">
    <div>
      {slopeData
        .filter(([id]) => id === 'E14000548')
        .slice(0, 5)
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

### Test case -- Tooting:

<Preview>
  <Story name="Test case -- Tooting">
    <div>
      {slopeData
        .filter(([id]) => id === 'E14000998')
        .slice(0, 5)
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

### Test case -- Ogmor:

<Preview>
  <Story name="Test case Ogmor">
    <div>
      {slopeData
        .filter(([id]) => id === 'W07000074')
        .slice(0, 5)
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

### Test case -- Sheffield, Brightside and Hillsborough:

<Preview>
  <Story name="Test case -- Sheffield, Brightside and Hillsborough">
    <div>
      {slopeData
        .filter(([id]) => id === 'E14000921')
        .slice(0, 5)
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

### Test case -- Oldham West and Royton:

<Preview>
  <Story name="Test case -- Oldham West and Royton">
    <div>
      {slopeData
        .filter(([id]) => id === 'E14000871')
        .slice(0, 5)
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

### Test case -- Peterborough

<Preview>
  <Story name="Test case -- Peterborough">
    <div>
      {slopeData
        .filter(([id]) => id === 'E14000878')
        .slice(0, 5)
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

### Test cases for interesting independents

<Preview>
  <Story name="Interesting independents test cases">
    <div>
      {slopeData
        .filter(([id]) => interestingIndependentConstituencyCodes.includes(id))
        .map(([id, d]) => (
          <SlopeChart title={id} key={id} constituencyCode={id} data={d} />
        ))}
    </div>
  </Story>
</Preview>

#### Weird edge cases

- E14000878 (2019 by-election; no data on hand)
- E14000647 (Copeland)
- E14000972 (Stoke on Trent Central)
- E14000896 (Tories won? Rounding error?)
- E14000871 (Oldham West by election missing)
- Paisley and Renfrewshire North E14000553
- Cities of London and Westminster E14000639
- Wells E14000553

<Preview>
  <Story name="Weird test cases">
    <div>
      {[
        'E14000878',
        'E14000647',
        'E14000972',
        'E14000896',
        'E14000871',
        'E14000553',
        'E14000639',
        'S14000052',
        'W07000068',
      ].map((id) => (
        <SlopeChart
          title={id}
          key={id}
          constituencyCode={id}
          data={finalSlopeData.find(([d]) => d === id)[1]}
        />
      ))}
    </div>
  </Story>
</Preview>

## E14000559 Birkenhead Social Justice Party edge case

<Preview>
  <Story name="E14000559 Birkenhead Social Justice Party edge case">
    <div>
      {['E14000559'].map((id) => (
        <SlopeChart
          title={id}
          key={id}
          constituencyCode={id}
          independentOverrides={['Birkenhead Social Justice Party']}
          data={finalSlopeData.find(([d]) => d === id)[1]}
        />
      ))}
    </div>
  </Story>
</Preview>
