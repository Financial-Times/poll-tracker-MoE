import { createNumericArray, createStringArray, createDatetimeArray } from "@flourish/enhanced-arrays";
import { isDate } from "../common";

var ERROR_MESSAGE = "Input data must be an array or Flourish array";


function getFrozenData(input_data, accessor) {
	if (!input_data) throw new TypeError(ERROR_MESSAGE);
	if (input_data.enhanced_array) return input_data;
	if (!Array.isArray(input_data)) throw new TypeError(ERROR_MESSAGE);

	var acc = accessor || function(x) { return x; };

	for (var i = 0; i < input_data.length; i++) {
		var value = acc(input_data[i]);
		var type = typeof value;
		if (type === "number") return createNumericArray(input_data, accessor);
		if (type === "string") return createStringArray(input_data, accessor);
		if (isDate(value)) return createDatetimeArray(input_data, accessor);
	}

	return createNumericArray(input_data, accessor);
}


function initData(instance) {
	var current_data = getFrozenData([]);

	return function(data, accessor) {
		if (data === undefined) return current_data;
		current_data = getFrozenData(data, accessor);
		return instance;
	};
}


export { initData };
