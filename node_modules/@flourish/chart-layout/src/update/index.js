import { updateRemToPx } from "../common";
import { initDebugUpdating } from "./debug";
import { initTickUpdating } from "./ticks";
import { initClipUpdating } from "./clip";
import { initBackgroundUpdating } from "./background";
import { initAxisUpdating } from "./axes";
import { initGridlineUpdating } from "./gridlines";


function initUpdate(instance, state) {
	var updateTransform = function() {
		var transform = null;
		if (instance.offsetLeft() || instance.offsetTop()) {
			transform = "translate(" + instance.offsetLeft() + "," + instance.offsetTop() + ")";
		}
		instance.chart.attr("transform", transform);
	};


	var updateDebug = initDebugUpdating(instance);
	var updateTicks = initTickUpdating(instance, state);
	var updateMargins = function(margins) { instance.margins._update(margins); };
	var updateClip = initClipUpdating(instance, state);
	var updateBackground = initBackgroundUpdating(instance, state);
	var updateAxes = initAxisUpdating(instance, state);
	var updateGridlines = initGridlineUpdating(instance, state);

	return function(opts) {
		opts = opts || {};
		updateRemToPx();
		updateTransform();
		updateDebug();
		updateTicks();
		updateMargins(opts.margins);
		if (opts.skip_rendering) return instance;
		updateClip();
		updateBackground();
		var measurements = updateAxes();
		updateGridlines(measurements);
		return instance;
	};
}


export { initUpdate };
