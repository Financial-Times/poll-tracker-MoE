import { quantile as d3_quantile, variance as d3_variance } from "d3-array";
import { isArray } from "../../../common";

function quantiles(sorted_data, vals) {
	if (!isArray(vals)) return d3_quantile(sorted_data, vals);
	return vals.map(function(d) { return d3_quantile(sorted_data, d); });
}


function addSummaries(add) {
	var variance = function() {
		return d3_variance(this.values);
	};

	var sd = function() {
		return Math.sqrt(this.variance);
	};

	var quartiles = function() {
		return quantiles(this.sorted_values, [ 0.25, 0.5, 0.75 ]);
	};

	var median = function() {
		return quantiles(this.sorted_values, 0.5);
	};

	var iqr = function() {
		var iq = quantiles(this.sorted_values, [ 0.25, 0.75 ]);
		return iq[1] - iq[0];
	};

	add.getter("variance", variance);
	add.getter("sd", sd);
	add.getter("median", median);
	add.getter("iqr", iqr);
	add.method("quantiles", function(vals) { return quantiles(this.sorted_values, vals); });
	add.method("quartiles", quartiles);
}


export default addSummaries;
