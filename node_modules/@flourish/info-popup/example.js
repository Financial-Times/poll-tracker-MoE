import initialisePopup from "@flourish/info-popup";
import state from "./state";
import data from "./data";
import { select, selectAll } from "d3-selection";

// initilisation  -----------------------------------------------
let popup;

function initPopup() {
	popup = initialisePopup(state.popup);
	popup
		.getLockedPosition(getLockedPositionCallback);
}

function getLockedPositionCallback(locked_id) {
	// if there is no locked popup
	if (state.locked_id === null) return null;

	// get the node that relates to this id (this is just one common way you might do this)
	const el_node = select(`#${locked_id}`).node();

	// get the data from that node
	const datum = el_node && el_node.__data__;

	// return node and data
	return [el_node, datum];
}

initPopup();


// updating popup -----------------------------------------------

function updateGraphic() {
	// your code that updates the rest of the graphic

	selectAll(".your_data_points") // select your datapoints
		.on("mouseover", function(data) {
			let el = this;
			popup.mouseover(el, data);
		})
		.on("mouseout", function() {
			popup.mouseout();
		})
		.on("click", function(data) {
			const locked_id = data.id; // adjust depending on what unique identifier your data has on it
			popup.click(this, data, locked_id);
		});


	updatePopup();
}


function updatePopup() {
	popup
		.setColumnNames(data.data.column_names)
		.update();
}


updateGraphic();
