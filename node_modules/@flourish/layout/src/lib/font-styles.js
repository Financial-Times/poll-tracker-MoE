import { state } from "../core/init";

var style_el;


function initFontStyles() {
	style_el = document.createElement("style");
	style_el.id = "flourish-page-styles";
	style_el.type = "text/css";
	document.head.appendChild(style_el);
}


function updateFontStyles() {
	var breakpoints = ["mobile_small", "mobile_big", "tablet", "desktop", "big_screen"];
	var breakpoint_css = "";

	breakpoints.forEach(function(breakpoint_name, i) {
		var css_media_query = "@media(min-width: " + state["breakpoint_" + breakpoint_name] + "px) {\n";
		var css_font_size = "html { font-size:" + state["font_size_" + breakpoint_name] + "%; }";
		breakpoint_css += (i == 0 ? "" : css_media_query) + css_font_size + (i == 0 ? "" : "\n}") + "\n\n";
	});

	style_el.innerHTML = breakpoint_css;

	// Check if we need to load fonts
	var fonts = [ state.body_font, state.title_font, state.subtitle_font, state.footer_font ];
	fonts.forEach(function(font) {
		if (!font) return;
		var font_already_loaded = false;

		var layout_fonts = document.head.querySelectorAll("link.layout-font");
		for (var i = 0; i < layout_fonts.length; i++) {
			var font_el = layout_fonts[i];
			if (font_el.href == font.url) font_already_loaded = true;
		}

		if (!font_already_loaded) {
			var font_link = document.createElement("link");
			font_link.setAttribute("rel", "stylesheet");
			font_link.setAttribute("href", font.url);
			font_link.className = "layout-font";
			document.head.appendChild(font_link);
		}
	});

	// Check if we need to remove fonts
	var layout_fonts = document.head.querySelectorAll("link.layout-font");
	for (var i = 0; i < layout_fonts.length; i++) {
		var font_el = layout_fonts[i];
		var font_needed = false;
		fonts.forEach(function(font) {
			if (font && font.url == font_el.href) font_needed = true;
		});
		if (!font_needed) font_el.parentElement.removeChild(font_el);
	}

	document.body.style.fontFamily = state.body_font.name;
}


export { initFontStyles, updateFontStyles };
